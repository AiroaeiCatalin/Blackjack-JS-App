<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackJack App</title>
</head>
<body>


    <div style="display: flex; flex-direction: column; align-items: center">

        <h3>Dealer Cards</h3>
        <div id="dealerScreen" style="width: 100%;
        min-height: 100px;
        margin-bottom:30px;
        border: 4px solid grey;
        display: flex;
        justify-content: center;
        max-width: 20rem;"></div>
        
        <h3>Your Cards</h3>
        <div id="cardScreen" style="width: 100%;
        min-height: 100px;
        border: 4px solid grey;
        display: flex;
        justify-content: center;
        max-width: 20rem;"></div>
       
       

        <div id="balance"> <h1>Balance: <span id="balanceScreen"></span></h1></div>
        <div id="endOfRoundMessage"></div>


        <br>
        <br>

        <div id="sitControls">
            <input id='sitValueField' type="text" placeholder="Enter Starting Balance Here..."/>
            <button id="sitButton">SIT</button>
        </div>

        
        <br>
        <br>

        <div id="dealControls">
            <select id="dealOption">
            </select>
            <button id="dealButton">DEAL</button>
        </div>

        
        <br>
        <br>
<!-- margin in loc de br? -->
        <div id="turnControls">
            <button id="hitButton">HIT</button>
            <button id="stayButton">STAY</button>
        </div>

        <br>
        <br>

        <div id="endOfRoundControls">
            <button id="playAnotherRound">PLAY ANOTHER ROUND</button>
            <button id="standButton">STAND</button>
        </div>

    </div>

</body>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>

        $( document ).ready(function() {
            console.log( "ready!" );

            let sitControls = $('#sitControls')
            let dealControls = $('#dealControls')
            let turnControls = $('#turnControls')
            let endOfRoundControls = $('#endOfRoundControls')
            let sitValueField = $('#sitValueField')
            let sitButton = $('#sitButton')
            let dealOption = $('#dealOption')
            let balanceScreen = $('#balanceScreen')
            let balance = $('#balance')


            function sit() {}
            function deal() {}
            function turn() {}
            function stand() {}

            //Hide everything besides sit controls
            function hideNonSitControls() {
               dealControls.hide()
               turnControls.hide()
               endOfRoundControls.hide()
               balance.hide()
            }

            function hideSitControls() {
                sitControls.hide()
            }

            function hideDealControls() {
                dealControls.hide()
            }
            function showDealControls() {
                dealControls.show()
            }

            function showTurnControls() {
                turnControls.show()
            }

            function hideTurnControls() {
                turnControls.hide()
            }

            function showEndOfRoundControls() {
                endOfRoundControls.show()
            }

            function appendPlayerCard(rank, suite) {
                $('#cardScreen').append(rank + suite + '<br>')
            }

            function appendDealerCard(rank, suite) {
                $('#dealerScreen').append(rank + suite + '<br>')
            }

            //vad daca nu se poate fara return
            function convertSuiteToSymbol(suite){
                switch (suite) {
                    case "Clubs":
                        return "♣";
                    case "Diamonds":
                        return "♢";
                    case "Hearts":
                        return "♡";
                    case "Spades":
                        return "♠";
                    
                }
                console.log(suite)
            }

            function changeBalance() {

            }

            function displayWinAmount() {

            }

            function endOfRound() {
                //hide SIT/STAY buttons
                //show DEAL button
                //show STAND button
            }


            function displayEndOfRoundMessage(won) {
                if (won > 0) {
                    $('#endOfRoundMessage').append("You Win")
                } else {
                    $('#endOfRoundMessage').append("You Lose")
                }
            }

            function endOfRoundHandler(data, status) {
                $('#dealerScreen').text('')

                $.each(data.dealerCards, function( index, value ) {
                    appendDealerCard(value.rank, convertSuiteToSymbol(value.suite))
                });

                hideTurnControls()
                showEndOfRoundControls()

                console.log(parseInt(data.winAmount))
                console.log(parseInt(data.winAmount) > 0)
                displayEndOfRoundMessage(parseInt(data.winAmount) ) //
                changeBalance() //
                displayWinAmount() //
            }





            // hide non-sit controls
            hideNonSitControls()

            // on SIT mut in functie de sit ce e in interior
            sitButton.click(function() {
            
                // if( sitValueField.val() >= 10  &&  sitValueField.val()  <= 1000) {
                    console.log( sitValueField.val() )
                    $('#endOfRoundMessage').text("")
                    hideSitControls()
                    showDealControls()
                    
                    $('#cardScreen').text('')
                    balance.show()
                    localStorage.balance = sitValueField.val() 
                    balanceScreen.text(sitValueField.val()  )

                    $.post("https://blackjack.fuzz.me.uk/sit", {"balance": localStorage.balance}, function(data, status) {
                        console.log('status ' +  status)
                            console.log('saving session ID in browser')
                            window.localStorage.blackjackSessionId = data.sessionId

                            //fac functie
                            $.each(data.availableBetOptions, function( index, value ) {
                                $('#dealControls select').append(`<option>${value}</option>`)
                            });
                        
                    }).fail(function(data) {
                        $('#cardScreen').append( JSON.parse(data.responseText).validation.body.message )
                        dealControls.hide()
                        balance.hide()
                        sitControls.show()
                    })
                
            })

            // on DEAL la fel, mut
            $('#dealButton').click(function() {
                console.log( dealOption.val() )
                hideDealControls()
                showTurnControls()

                $.post("https://blackjack.fuzz.me.uk/deal", {"bet": dealOption.val(),"sessionId": window.localStorage.blackjackSessionId}, function(data, status) {
                
                    // If round is not over
                    if(data.roundEnded === false) {


                        $.each(data.playerCards, function( index, value ) {
                            appendPlayerCard(value.rank, convertSuiteToSymbol(value.suite))
                        });

                        // dealer has only one card on DEAL stage (the other card is face down)
                        appendDealerCard(data.dealerCards[0].rank, convertSuiteToSymbol(data.dealerCards[0].suite))
                        
                    }
                    
                });
            })

            // on TURN
            $('#hitButton').click(function() {
                $.post("https://blackjack.fuzz.me.uk/turn", {"action": "hit","sessionId": window.localStorage.blackjackSessionId}, function(data, status) {
                
                    appendPlayerCard(data.playerCard.rank, convertSuiteToSymbol(data.playerCard.suite))

                    // If round is not over
                    if(data.roundEnded === true) {
                        endOfRoundHandler(data, status)
                    }
                    
                    
                })
            })

            $('#stayButton').click(function() {
                
                $.post("https://blackjack.fuzz.me.uk/turn", {"action": "stay","sessionId": window.localStorage.blackjackSessionId}, function(data, status) {
                
                    endOfRoundHandler(data, status)
                })
            })


        });

    </script>
</body>
</html>



